<!DOCTYPE html>
<html>
<head>
    <title>Dollar Beer Night</title>
    <link rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body>
<h2>ğŸº Dollar Beer Night</h2>

<form action="/add" method="POST">
    <input name="name" placeholder="Bar Name" required><br>
    <input name="special" placeholder="$1.50 cans etc" required><br>
    <input name="address" placeholder="City / Address" required><br>

    <select name="day">
        <option>Monday</option>
        <option>Tuesday</option>
        <option>Wednesday</option>
        <option>Thursday</option>
        <option>Friday</option>
        <option>Saturday</option>
        <option>Sunday</option>
    </select><br>

    <button type="submit">Save Special</button>
</form>

<hr>

<h3>Find Beer Near Me</h3>
<button onclick="loadBars()">Find Bars</button>

<div id="map" style="height:500px;"></div>

<script>
var map = L.map('map').setView([41.1, -80.6], 11);

L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
}).addTo(map);

navigator.geolocation.getCurrentPosition(pos => {
    var lat = pos.coords.latitude;
    var lng = pos.coords.longitude;

    map.setView([lat,lng], 12);
    L.marker([lat,lng]).addTo(map)
      .bindPopup("You are here").openPopup();
});

function loadBars(){
    fetch("/bars")
    .then(r => r.json())
    .then(data => {
        data.forEach(bar => {
            if(bar.lat && bar.lng){
                L.marker([bar.lat, bar.lng])
                 .addTo(map)
                 .bindPopup(
                    "<b>"+bar.name+"</b><br>"
                    +bar.special+"<br>"
                    +bar.day
                 );
            }
        });
    });
}
</script>

</body>
</html>
