<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üç∫ Dollar Beer Night</title>

<link rel="stylesheet"
href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body { font-family: Arial; padding:20px; background:#f5f5f5;}
input,button { width:100%; padding:12px; margin:6px 0;}
button { background:#2d6cdf; color:white; border:none; }
#map { height:400px; margin-top:15px;}
</style>
</head>

<body>

<h1>üç∫ Dollar Beer Night</h1>

<h3>Add Special</h3>

<input id="barName" placeholder="Bar Name">
<input id="deal" placeholder="Deal Description">
<input id="location" placeholder="City, State or Address">

<button onclick="saveSpecial()">Save Special</button>

<h3>Find Specials</h3>
<button onclick="findNearMe()">Find Specials Near Me</button>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let map = L.map("map").setView([41.0998,-80.6495],11);

L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{
 attribution:"¬© OpenStreetMap"
}).addTo(map);

// Convert city/state ‚Üí coordinates
async function geocode(place){
 const res = await fetch(
  `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(place)}`
 );
 const data = await res.json();
 if(!data.length){ alert("Location not found"); return null;}
 return {
  lat: parseFloat(data[0].lat),
  lon: parseFloat(data[0].lon)
 };
}

async function saveSpecial(){
 const barName = document.getElementById("barName").value;
 const deal = document.getElementById("deal").value;
 const place = document.getElementById("location").value;

 if(!barName || !deal || !place){
  alert("Fill everything out.");
  return;
 }

 const coords = await geocode(place);
 if(!coords) return;

 const special = {
  barName,
  deal,
  lat: coords.lat,
  lon: coords.lon
 };

 let specials = JSON.parse(localStorage.getItem("specials")) || [];
 specials.push(special);
 localStorage.setItem("specials", JSON.stringify(specials));

 loadSpecials();
 alert("Saved");
}

function loadSpecials(){
 const specials = JSON.parse(localStorage.getItem("specials")) || [];
 specials.forEach(s=>{
  L.marker([s.lat,s.lon])
   .addTo(map)
   .bindPopup(`<b>${s.barName}</b><br>${s.deal}`);
 });
}
loadSpecials();

function findNearMe(){
 navigator.geolocation.getCurrentPosition(pos=>{
  const lat=pos.coords.latitude;
  const lon=pos.coords.longitude;
  map.setView([lat,lon],13);
  L.marker([lat,lon]).addTo(map).bindPopup("You are here").openPopup();
 });
}
</script>

</body>
</html>
