<!DOCTYPE html>
<html>
<head>
    <title>Beer Dollars</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet"
          href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

    <style>
        body {margin:0;font-family:Arial;background:#f4f6f9;}
        .header {
            background:#2f80ed;color:white;
            padding:20px;text-align:center;
        }
        .section {padding:20px;}
        #map {height:300px;border-radius:12px;margin-top:20px;}
        input,button {
            width:100%;padding:10px;margin-top:10px;
            border-radius:8px;border:1px solid #ddd;
        }
        button {background:#2f80ed;color:white;font-weight:bold;}
    </style>
</head>

<body>

<div class="header">
    <h1>üç∫ Beer Dollars</h1>
    <p>Stretch Your Beer Money</p>
</div>

<div class="section">

    <input id="bar" placeholder="Bar name">
    <input id="address" placeholder="Address">
    <input id="deal" placeholder="Deal">
    <input id="day" placeholder="Day">

    <button onclick="addSpecial()">Add Special</button>

    <div id="map"></div>

</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let map = L.map('map').setView([41.0998, -80.6495], 11);
let markers = [];

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
.addTo(map);

function clearMarkers(){
    markers.forEach(m=>map.removeLayer(m));
    markers=[];
}

function loadDay(day){
    fetch(`/get_specials/${day}`)
    .then(r=>r.json())
    .then(data=>{
        clearMarkers();

        data.forEach(bar=>{
            if(bar.latitude && bar.longitude){
                let m=L.marker([bar.latitude,bar.longitude])
                .addTo(map)
                .bindPopup(`<b>${bar.bar_name}</b><br>${bar.deal}`);
                markers.push(m);
            }
        });
    });
}

function addSpecial(){

    let payload={
        bar_name:document.getElementById("bar").value,
        address:document.getElementById("address").value,
        deal:document.getElementById("deal").value,
        day:document.getElementById("day").value
    };

    fetch("/add_special",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(payload)
    })
    .then(r=>r.json())
    .then(res=>{
        if(res.success){
            loadDay(payload.day);
            alert("Saved!");
        }else{
            alert("Save failed");
        }
    });
}
</script>

</body>
</html>
