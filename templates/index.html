<!DOCTYPE html><html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dollar Beer Night</title><link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script><style>
body{font-family:Arial;margin:0;padding:12px;background:#f4f4f4;}
h2{text-align:center;}
input,button{width:100%;padding:10px;margin:6px 0;border-radius:6px;border:1px solid #ccc;font-size:16px;}
button{background:#2563eb;color:white;border:none;cursor:pointer;}
#map{height:350px;margin-top:10px;border-radius:10px;}
.result{background:white;padding:10px;margin-top:6px;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,.12);} 
</style></head>
<body><h2>üç∫ Dollar Beer Night</h2><h3>Add Special</h3>
<input id="barName" placeholder="Bar Name" />
<input id="dealDesc" placeholder="Deal ($1.50 etc)" />
<input id="address" placeholder="Bar Address or City" />
<input id="day" placeholder="Day (Sunday‚ÄìSaturday)" />
<button onclick="saveSpecial()">Save Special</button><h3>Find Specials Near Me</h3>
<button onclick="locateUser()">Locate Me</button><div id="map"></div>
<div id="results"></div><script>
let map;
let userMarker;
let barMarkers=[];

function initMap(){
  map=L.map('map').setView([41.055,-80.619],13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
}
initMap();

function normalizeDay(day){
  const days=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
  return days.find(d=>d.toLowerCase()===day.toLowerCase())||day;
}

async function geocode(address){
  const url=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`;
  const res=await fetch(url);
  const data=await res.json();
  if(!data.length) return null;
  return {lat:parseFloat(data[0].lat),lng:parseFloat(data[0].lon)};
}

async function saveSpecial(){
  const name=document.getElementById('barName').value.trim();
  const deal=document.getElementById('dealDesc').value.trim();
  const address=document.getElementById('address').value.trim();
  const day=normalizeDay(document.getElementById('day').value.trim());

  if(!name||!deal||!address||!day){
    alert('Fill everything');
    return;
  }

  const coords=await geocode(address);
  if(!coords){
    alert('Address not found');
    return;
  }

  const specials=JSON.parse(localStorage.getItem('specials')||'[]');
  specials.push({name,deal,address,day,lat:coords.lat,lng:coords.lng});
  localStorage.setItem('specials',JSON.stringify(specials));

  document.querySelectorAll('input').forEach(i=>i.value='');
  alert('Saved');
}

function locateUser(){
  navigator.geolocation.getCurrentPosition(pos=>{
    const lat=pos.coords.latitude;
    const lng=pos.coords.longitude;

    map.setView([lat,lng],14);

    if(userMarker) map.removeLayer(userMarker);
    userMarker=L.marker([lat,lng]).addTo(map)
      .bindPopup('You are here').openPopup();

    showTodaySpecials();
  });
}

function clearBars(){
  barMarkers.forEach(m=>map.removeLayer(m));
  barMarkers=[];
}

function showTodaySpecials(){
  clearBars();

  const specials=JSON.parse(localStorage.getItem('specials')||'[]');
  const results=document.getElementById('results');
  results.innerHTML='';

  const today=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'][new Date().getDay()];

  const filtered=specials.filter(s=>s.day===today);

  if(!filtered.length){
    results.innerHTML='<p>No specials today.</p>';
    return;
  }

  filtered.forEach(s=>{
    const marker=L.marker([s.lat,s.lng]).addTo(map)
      .bindPopup(`${s.name}<br>${s.deal}`);
    barMarkers.push(marker);

    const div=document.createElement('div');
    div.className='result';
    div.innerHTML=`<b>${s.name}</b> ‚Äî ${s.deal}<br>${s.address}<br>Day: ${s.day}`;
    results.appendChild(div);
  });
}
</script></body>
</html>
